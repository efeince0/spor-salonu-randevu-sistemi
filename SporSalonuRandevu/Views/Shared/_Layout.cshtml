@inject SporSalonuRandevu.Data.UygulamaDbContext _context

@{
    var uyeId = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;

    var okunmamisSayisi =
        User.Identity?.IsAuthenticated == true && User.IsInRole("Uye") && uyeId != null
        ? _context.Bildirimler.Count(b => b.UyeId == uyeId && !b.OkunduMu)
        : 0;
}

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - SporSalonuRandevu</title>

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>

<body>
    <div class="app-layout">

        <!-- ================= SIDEBAR ================= -->
        <aside class="sidebar">

            <!-- LOGO -->
            <div class="sidebar-logo">
                🏋️ <span>SporSalonu</span>
            </div>

            <!-- ================= MENÜ ================= -->
            <nav class="sidebar-nav">

                @if (User.Identity?.IsAuthenticated == true && User.IsInRole("Admin"))
                {
                    <nav class="sidebar-nav">

                        <!-- DASHBOARD -->
                        <a asp-controller="Admin" asp-action="Index" class="nav-item">
                            ⚙️ <span>Dashboard</span>
                        </a>

                        <!-- RANDEVU -->
                        <a asp-controller="Admin" asp-action="RandevuYonetimi" class="nav-item">
                            📅 <span>Randevu Yönetimi</span>
                        </a>

                        <!-- HİZMET -->
                        <a asp-controller="Admin" asp-action="Hizmetler" class="nav-item">
                            💪 <span>Hizmet Yönetimi</span>
                        </a>

                        <!-- ANTRENÖR -->
                        <a asp-controller="Admin" asp-action="Antrenorler" class="nav-item">
                            🧑‍🏫 <span>Antrenör Yönetimi</span>
                        </a>

                    </nav>
                }



                @* ========== UYE MENÜ ========== *@
                @if (User.Identity?.IsAuthenticated == true && User.IsInRole("Uye"))
                {
                    <a asp-controller="Home" asp-action="Index" class="nav-item">
                        🏠 <span>Ana Sayfa</span>
                    </a>

                    <a asp-controller="Hizmet" asp-action="Index" class="nav-item">
                        💪 <span>Hizmetler</span>
                    </a>

                    <a asp-controller="Ai" asp-action="DiyetEgzersiz" class="nav-item">
                        🤖 <span>AI Diyet & Egzersiz</span>
                    </a>

                    <a asp-controller="Profil" asp-action="Randevularim" class="nav-item">
                        📅 <span>Randevularım</span>
                    </a>
                }
            </nav>

            <!-- ================= FOOTER ================= -->
            <div class="sidebar-footer">

                @if (User.Identity?.IsAuthenticated == true)
                {
                    @* SADECE UYE *@
                    @if (User.IsInRole("Uye"))
                    {
                        <a asp-controller="Profil" asp-action="Bilgilerim" class="nav-item small">
                            👤 Profilim
                        </a>

                        <a asp-controller="Profil"
                           asp-action="Bildirimler"
                           class="nav-item position-relative">
                            🔔 <span>Bildirimler</span>

                            @if (okunmamisSayisi > 0)
                            {
                                <span class="badge bg-danger position-absolute top-0 end-0 translate-middle">
                                    @okunmamisSayisi
                                </span>
                            }
                        </a>
                    }

                    <a asp-controller="Account" asp-action="Logout" class="nav-item logout">
                        🚪 Çıkış Yap
                    </a>
                }
                else
                {
                    <a asp-controller="Account" asp-action="Login" class="nav-item">
                        🔐 Giriş Yap
                    </a>

                    <a asp-controller="Account" asp-action="Register" class="nav-item register">
                        📝 Kayıt Ol
                    </a>
                }
            </div>
        </aside>

        <!-- ================= CONTENT ================= -->
        <main class="content">
            @RenderBody()
        </main>

    </div>

    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
